# This is a Databricks asset bundle definition for pdf_ingestion.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: pdf_ingestion

include:
  - resources/pdf_ingestion_benchmark.yml
  - resources/pdf_ingestion_job.yml

variables:
  my_dev_host:
    description: "Databricks workspace host for development"
  my_prd_host:
    description: "Databricks workspace host for production"
  my_user_name:
    description: "Databricks user name"
  node_type_id:
    description: "node type id"
    default: i3.2xlarge
  num_workers:
    description: "number of workers"
    default: 20
  catalog:
    description: "unity catalog name"
    default: main
  schema:
    description: "schema name"
    default: pdf_documents
  volume:
    description: "source file volume"
    default: pdf_batch_store
  checkpoints_volume:
    description: "checkpoints volume"
    default: checkpoints
  reset_data:
    description: "reset data boolean flag"
    default: "true"
  table_prefix:
    description: "output table prefix"
    default: my_project

targets:
  # The 'dev' target, for development purposes. This target is the default.
  dev:
    # We use 'mode: development' to indicate this is a personal development copy:
    # - Deployed resources get prefixed with '[dev my_user_name]'
    # - Any job schedules and triggers are paused by default
    # - The 'development' mode is used for Delta Live Tables pipelines
    mode: development
    default: true
    workspace:
      host: ${var.my_dev_host}

  ## Optionally, there could be a 'staging' target here.
  ## (See Databricks docs on CI/CD at https://docs.databricks.com/dev-tools/bundles/ci-cd.html.)
  #
  # staging:
  #   workspace:
  #     host: ${workspace.host}

  # The 'prod' target, used for production deployment.
  prod:
    # We use 'mode: production' to indicate this is a production deployment.
    # Doing so enables strict verification of the settings below.
    mode: production
    workspace:
      host: ${var.my_prd_host}
      root_path: /Users/${var.my_user_name}/.bundle/${bundle.name}/${bundle.target}
    run_as:
      # This runs as q.yu@databricks.com in production. We could also use a service principal here,
      # see https://docs.databricks.com/dev-tools/bundles/permissions.html.
      user_name: ${my.my_user_name}
